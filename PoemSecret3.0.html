<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>诗词秘境 - 互动影游</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: #0c0c0c;
            color: #e4d5b7;
            overflow: hidden;
            height: 100vh;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease;
            padding: 20px;
        }
        
        /* --封面页样式-- */
        #cover-screen { /*封面页容器*/
            display: flex;
            opacity: 1;
            z-index: 5;

            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7));
            background-size: cover; /*确保背景图案完全覆盖容器，适应不同屏幕尺寸*/
            text-align: center; /*文本类元素（标题、按钮）水平居中对齐*/
            
        }
        
        .cover-content { /*封面内容容器*/
            max-width: 2000px; /*限制最大宽度为 2000px*/
            padding: 20px; /*内边距为 20px*/
        }
        
        .game-title { /*游戏标题*/
            font-size: 4em;
            color: #d4af37;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.7);
            letter-spacing: 5px; /* 字间距 */
        }
        
        .game-subtitle { /*游戏副标题*/
            font-size: 1.5em;
            margin-bottom: 40px; /*底部外边距（40px）*/
            color: #b08d57;
        }
        
        .start-btn { /*开始游戏按钮*/
            background: linear-gradient(to bottom, #8b0000, #600000);
            border: 2px solid #d4af37;
            color: #e4d5b7;
            padding: 15px 50px; /* 内边距：上下15px，左右50px */
            font-size: 1.5em;
            border-radius: 50px; /* 圆角，类似胶囊形状 */
            cursor: pointer;  /* 鼠标悬停显示手型 */
            transition: all 0.3s ease; /* 过渡动画：所有样式变化在0.3s内完成 */
            margin-top: 30px;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5); /* 红色阴影，增强立体感 */
        }
        
        .start-btn:hover { /*鼠标悬停效果*/
            transform: scale(1.05); /* 鼠标悬停时放大5% */
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.7); /* 阴影扩大、加深 */
            background: linear-gradient(to bottom, #a52a2a, #700000); /* 背景色变亮 */
        }
        
        /* --游戏界面样式-- */
        #game-screen { /*游戏主界面容器*/
            display: none; /*初始隐藏，通过 JS 切换为显示 */
            opacity: 0; /* 初始透明（配合淡入动画） */
            z-index: 9;
            background: #000;
            transition: opacity 500ms ease; /* 与 setTimeout 时长匹配 */
        }
        
        .video-container { /*视频容器*/
            /* position: relative; 关键：让进度条相对于容器定位 */
            width: 100%;
            height: calc(100% - 10px);
            /* background: #111; */
            border-radius: 10px; /* 圆角边框 */
            /* overflow: hidden; 裁剪超出容器的内容（如视频边缘） */
            /* margin-bottom: 20px;  与下方选项区保持距离 */
            z-index: 20; /* 视频层级低于选项 */
        }

        .choices-container { /*选项按钮容器*/
            position: absolute; /* 绝对定位，确保在视频容器内 */
            overflow: visible; /* 确保按钮不被容器自身裁剪 */
            height: auto;
            min-height: 30%;
            bottom: 20px;
            padding: 20px;
            display: flex; /* 弹性布局，控制按钮排列 */
            /*flex-direction: column;*/
            justify-content: center; /* 主轴（默认水平）居中 */
            align-items: center; /* 交叉轴（默认垂直）居中 */
            /*background: rgba(20, 20, 20, 0.8);*/
            width: 95%;
            border-radius: 15px;
            gap: 15px; /* 增加内边距，避免按钮贴近边缘 */
            z-index: 29; /* 提高层级，确保在其他元素上方 */
        }
        
        .choice-btn { /*选项按钮*/
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8b0000;
            border-radius: 10px; /* 圆角 */
            padding: 15px 30px; /* 内边距，确保按钮足够大 */
            color: #e4d5b7;
            font-size: 1.2em;
            cursor: pointer; /* 鼠标悬停显示手型 */
            transition: all 0.3s ease; /* 所有样式变化带0.3s过渡动画 */
            margin: 10px 0;
            width: 80%; /* 宽度占容器80%，保持一致性 */
            max-width: 600px; /* 最大宽度限制，避免宽屏上按钮过宽 */
            text-align: center;
            -webkit-backdrop-filter: blur(5px); /* 适配 Safari */
            backdrop-filter: blur(5px); /* 标准属性，其他浏览器 */
            z-index: 20; 
        }
        
        .choice-btn:hover { /*悬停效果*/
            background: rgba(139, 0, 0, 0.5);
            border-color: #ffd700;
            transform: translateY(-3px); /* 轻微上移，模拟“抬起”效果 */
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .scene-info { /*场景信息*/
            position: absolute; /* 绝对定位在界面左上角 */
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5); /* 半透明黑背景 */
            padding: 10px 20px;
            border-radius: 5px;
            border-left: 3px solid #b7972e;
        }
        
        /* --结局页面样式-- */
        #ending-screen { /*结局页面容器*/
            display: none; /*初始隐藏，仅在游戏结束时通过 JS 显示 */
            opacity: 0;
            z-index: 10;

            /* background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8));
            background-size: cover; */
            text-align: center; /*所有文本类元素水平居中*/
            transition: opacity 500ms ease; /* 淡入动画 */
            
        }
        
        .ending-content { /* 结局内容容器*/
            position: relative;
            max-width: 800px;
            padding: 30px;
            background: rgba(20, 20, 20, 0.8); /* 半透明深灰背景 */
            border-radius: 15px; /* 圆角边框 */
            border: 2px solid #d4af37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            z-index: 11;
        }
        
        .ending-title { /*结局标题*/
            font-size: 3em;
            color: #d4af37;
            margin-bottom: 20px;
            z-index: 12;
        }
        
        .ending-description { /*结局描述*/
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
            z-index: 12;
        }
        
        .ending-buttons { /*结局按钮容器*/
            display: flex; /* 弹性布局 */
            gap: 15px; /* 按钮之间间距 */
            justify-content: center; /* 水平居中排列 */
            flex-wrap: wrap; /* 屏幕较小时自动换行 */
            z-index: 12;
        }
        
        .restart-btn { /*重新开始按钮*/
            background: linear-gradient(to bottom, #8b0000, #600000);
            border: 2px solid #d4af37;
            color: #e4d5b7;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 50px; /* 胶囊形圆角 */
            cursor: pointer; /* 鼠标悬停显示手型 */
            transition: all 0.3s ease; /* 过渡动画 */
            z-index: 12;
        }
        
        .restart-btn:hover { /*悬停效果*/
            transform: scale(1.05); /* 悬停时轻微放大 */
            background: linear-gradient(to bottom, #a52a2a, #700000); /* 背景色变亮 */
        }

        /* 故事线页面基础样式 */
        #storyline-screen {
            display: none;
            z-index: 20;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.97);
            padding: 20px;
            overflow: auto;
        }

        .storyline-header {
            display: sticky;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #d4af37;
        }

        .storyline-header h2 {
            color: #d4af37;
            font-size: 2em;
            margin: 0;
        }

        .close-btn {
            position: fixed; /* 固定定位，相对于窗口右上角 */
            top: 20px;
            right: 20px;
            z-index: 21;
            background: transparent; 
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #d4af37;
            color: #000;
        }

        .storyline-container {
            width: 100%;
            min-height: calc(100vh - 120px);
            position: relative;
        }

        /*故事线*/
        #storyline-graph {
            width: 95%;
            height: 95%;
            position: relative;
            min-width: 5200px;
            min-height: 1100px; 
        }

        .story-node { /* 节点样式 - 仅显示video和ending类型 */
            position: absolute;
            z-index: 2;
            padding: 10px 15px;
            border-radius: 8px;
            color: #fff;
            font-size: 0.9em;
            text-align: center;
            cursor: default;
            transition: all 0.3s ease;
            /* min-width: 120px; */
            width: 150px; /* 自定义宽度 */
        }

        .story-node.video { /* 视频场景节点样式 */
            background: #2c3e50;
            border: 2px solid #3498db;
        }
        
        .story-node.ending { /* 结局节点样式 */
            background: #5d2555;
            border: 2px solid #9b59b6;
        }

        .story-node.visited { /* 已访问节点样式 */
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .story-node.video.visited {
            border-color: #d4af37;
        }

        .story-node.ending.visited {
            border-color: #d4af37;
        }

        .story-node.current { /* 当前节点高亮 */
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.8);
        }


        .story-connector { /* 连接线样式 - 包含choice信息 */
            z-index: 1;
            position: absolute;
            background: #666;
            transform-origin: 0 0;
        }

        .connector-horizontal {
            height: 2px;
        }

        .connector-vertical {
            width: 2px;
        }

        /* .choice-point { /* 选择点样式（choice显示在连接线上）
            position: absolute;
            z-index: 3;
            width: 16px;
            height: 16px;
            background: #34495e;
            border: 2px solid #d4af37;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .choice-label {
            position: absolute;
            z-index: 3;
            background: rgba(0, 0, 0, 0.8);
            color: #d4af37;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
        } */

        /* --动画效果---定义脉冲动画关键帧-- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); } /* 起始状态：完全透明，向下偏移20px */
            to { opacity: 1; transform: translateY(0); } /* 结束状态：完全可见，回到原位置 */
        }

        .fade-in { /* 节点加载动画 */
            animation: fadeIn 0.6s ease forwards; /* 使用fadeIn动画，持续0.6秒，缓动效果，保持结束状态 */
        }

    </style>
</head>
<body>
    <!-- 封面页 -->
    <div id="cover-screen" class="screen">  <!-- 封面页容器（div#cover-screen.screen）-->
        <!--id="cover-screen"：唯一标识该元素，用于在 CSS 和 JavaScript 中精准定位和控制-->
        <!--（如通过 getElementById('cover-screen') 操作其显示 / 隐藏）。-->
        <div class="cover-content">  <!-- 封面内容容器（div.cover-content）-->
            <h1 class="game-title">诗词秘境</h1>
            <p class="game-subtitle">阿橙的"诗词秘境"开发日志</p>
            <div class="pulse">  <!-- 脉冲动画容器(div.pulse)-->
                <button type="button" class="start-btn" id="start-btn">开始游戏</button>
                <!--id="start-btn"：唯一标识按钮，方便 JavaScript 绑定点击事件-->
                <!--（如 startBtn.addEventListener('click', startGame)）。-->
            </div>
        </div>
    </div>
    
    <!-- 游戏界面 -->
    <div id="game-screen" class="screen">  <!--游戏界面容器（div#game-screen.screen）-->
        <!--id="game-screen"：唯一标识游戏主界面，用于 JS/CSS 精准控制-->
        <!--（如通过 JS 切换显示状态，通过 CSS 设置黑色背景、初始隐藏等）。-->
        <div class="video-container">  <!-- 视频容器（div.video-container）-->
            <video id="videoPlayer"  style="display: none; max-width: 100%;"></video>  <!-- 视频播放器（video#videoPlayer）-->
            <!--id="videoPlayer"：JS 通过该 ID 获取元素，动态设置视频源-->
            <!--（如 videoPlayer.src = "scene1.mp4"）。-->
            <div class="scene-info" id="scene-info">第一章：创意的基石</div> <!--场景信息（div.scene-info#scene-info）-->
            <!--id="scene-info"：方便 JS 动态更新场景信息-->
            <!--（如切换章节时，通过 sceneInfo.textContent = "第二章：..." 修改内容）。-->
        </div>
        
        <div class="choices-container" id="choices-container">  <!--选项按钮容器（div.choices-container#choices-container）-->
            <!--id="choices-container"：JS 通过该 ID 动态生成并添加选项按钮-->
            <!--（如根据当前场景数据，创建多个 <button> 元素插入其中）。-->
            <!-- 选择按钮将通过JavaScript动态生成 -->
        </div>
    </div>

    <!-- 结局页面 -->
    <div id="ending-screen" class="screen">  <!--结局页面容器（div#ending-screen.screen）-->
        <!--id="ending-screen"：唯一标识结局页面，用于 JS/CSS 精准控制-->
        <!--（如通过 JS 触发显示，通过 CSS 设置高层级覆盖其他界面）。-->
        <div class="ending-content">  <!--结局内容容器（div.ending-content）-->
            <h2 class="ending-title" id="ending-title"></h2>  <!--结局标题（h2.ending-title#ending-title）-->
            <!--id="ending-title"：方便 JS 动态修改标题内容-->
            <!--（不同结局显示不同标题，如通过 endingTitle.textContent = "诗词大师结局" 更新）-->
            <p class="ending-description" id="ending-description"></p>  <!--结局描述（p.ending-description#ending-description）-->
            <!--id="ending-description"：支持 JS 动态更新内容-->
            <!--（如不同分支结局对应不同描述，通过脚本插入具体文本）。-->
            <div class="ending-buttons">  <!--结局按钮容器（div.ending-buttons）-->
                <button type="button"class="restart-btn" id="restart-btn">重新开始</button>  <!-- 重新开始按钮（button.restart-btn#restart-btn）-->
                <!--id="restart-btn"：方便 JS 绑定点击事件-->
                <!--（如 restartBtn.addEventListener('click', resetGame)），点击后重置游戏状态并返回封面页或初始场景-->
            </div>
        </div>
    </div>

    <!-- 故事线页面 -->
    <div id="storyline-screen" class="screen">
        <div class="storyline-header">
            <h2>故事脉络</h2>
            <button id="close-storyline" class="close-btn">返回游戏</button>
        </div>
        <div class="storyline-container">
            <div id="storyline-graph"></div>
        </div>
    </div>

    <!-- 场景展示容器 -->
    <div id="sceneContainer"></div>  <!-- 场景展示容器（div#sceneContainer）-->
        <!--id="sceneContainer"：用于展示当前场景的视频或图片-->
        <!--（如通过 JS 动态加载不同场景的内容，如 sceneContainer.innerHTML = `<img src="scene1.jpg" alt="场景1">`）。-->

    <!-- 视频播放器容器 -->
    <div id="videoContainer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100;">
        <video id="videoPlayer1" style="width: 100%; height: 100%; object-fit: contain;" controls>
            您的浏览器不支持视频播放
        </video>
        <div id="videoLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white;">
            视频加载中...
        </div>
    </div>

    <script>
        // 游戏状态
        let currentScene = 'start';
        // let gameState = {
        //     choices: []
        // };
        
        // 保存游戏历史
        let gameHistory = [];
        
        // DOM元素
        // 页面容器类
        const coverScreen = document.getElementById('cover-screen');   // 封面页容器
        const endingScreen = document.getElementById('ending-screen'); // 结局页容器
        const gameScreen = document.getElementById('game-screen');     // 游戏主界面容器
        //后续可通过这些变量控制页面的显示 / 隐藏（如 coverScreen.style.display = 'none' 隐藏封面页）、修改样式（如透明度、背景等）。

        // 结局页内容元素
        const endingTitle = document.getElementById('ending-title');              // 结局标题
        const endingDescription = document.getElementById('ending-description');  // 结局描述
        //例如：游戏结束时，通过 endingTitle.textContent = "完美结局" 或 endingDescription.innerHTML = "你成功通关..." 替换默认文本，展示不同结局。
        
        //交互按钮类
        const startBtn = document.getElementById('start-btn');                 // 开始游戏按钮
        const restartBtn = document.getElementById('restart-btn');             // 重新开始按钮
        const backToEndingBtn = document.getElementById('back-to-ending-btn'); // 返回结局页按钮
        //例如：startBtn.addEventListener('click', startGame) 就是通过这个变量为 “开始按钮” 绑定点击逻辑。
        const choicesContainer = document.getElementById('choices-container'); // 选项按钮容器
        //用于动态生成选项按钮的容器，例如通过 choicesContainer.appendChild(button) 向其中添加新按钮。

        const videoPlayer = document.getElementById('videoPlayer'); //视频播放器
        //HTML5 视频播放器元素，用于控制视频播放（如 videoPlayer.play() 播放、videoPlayer.src = "xxx.mp4" 设置视频源）。
        const sceneInfo = document.getElementById('scene-info');  // 场景信息文本
        //显示当前章节 / 场景信息的元素，可通过 sceneInfo.textContent = "第二章：..." 动态更新场景标题。
        
        const storylineScreen = document.getElementById('storyline-screen');
        const storylineGraph = document.getElementById('storyline-graph');
        const closeStorylineBtn = document.getElementById('close-storyline');

        //界面场景及跳转逻辑
        const gameScenes = {
            //第一章
            'start': {
                type: 'video',
                title: '第一章：创意的基石',
                //description: '宿舍，夜晚。阿橙看着电脑上的"两创"课题要求，陷入沉思。',
                videoNote: 'video/1.mp4',
                next: 'scene2'
            },
            //第二章
            'scene2': {
                type: 'video',
                title: '第二章：技术路线的豪赌',
                //description: '阿橙独白："这是一条绝路，也是唯一能通往奇迹的路。"',
                videoNote: 'video/2.mp4',
                next: 'choice2'
            },
            'choice2': {
                type: 'choice',
                title: '第二章：技术路线的豪赌',
                //question: '【出现选项：技术实现路径】',
                choices: [
                    {
                        text: '自研引擎',
                        nextScene: 'scene2.1',
                        stats: { tech: 20, art: 10, progress: -5 }
                    },
                    {
                        text: '主流框架',
                        nextScene: 'scene2.2',
                        stats: { tech: -5, art: 0, progress: 15 }
                    },
                    {
                        text: '轻量化方案',
                        nextScene: 'scene2.3',
                        stats: { tech: -10, art: -20, progress: 10 }
                    },
                    {
                        text: '混合现实(MR)',
                        nextScene: 'scene2.4',
                        stats: { tech: 15, art: 10, progress: -15 }
                    }
                ]
            },
            'scene2.1': {
                type: 'video',
                title: '自研引擎',
                //description: '阿橙独白："这是一条绝路，也是唯一能通往奇迹的路。"',
                videoNote: 'video/2.1.mp4',
                next: 'scene3'
            },
            'scene2.2': {
                type: 'video',
                title: '主流框架',
                videoNote: 'video/2.2.mp4',
                next: 'choice2.2',
            },
            'scene2.3': {
                type: 'video',
                title: '轻量化方案',
                videoNote: 'video/2.3.mp4',
                next: 'ending1'
            },
            'scene2.4': {
                type: 'video',
                title: '混合现实(MR)',
                videoNote: 'video/2.4.mp4',
                next: 'ending2'
            },
            'choice2.2': {
                type: 'choice',
                title: '主流框架',
                choices: [
                    {
                        text: '接受现实',
                        nextScene: 'scene2.2.A'
                    },
                    {
                        text: '开发滤镜',
                        nextScene: 'scene2.2.B'
                    },
                    {
                        text: '推翻重来',
                        nextScene: 'scene2.2.C'
                    }
                ]
            },
            'scene2.2.A': {
                type: 'video',
                title: '接受现实',
                videoNote: 'video/2.2.A.mp4',
                next: 'ending3'
            },
            'scene2.2.B': {
                type: 'video',
                title: '开发滤镜',
                videoNote: 'video/2.2.B.mp4',
                next: 'ending4'
            },
            'scene2.2.C': {
                type: 'video',
                title: '推翻重来',
                videoNote: 'video/2.2.C.mp4',
                next: 'ending5'
            },

            //第三章
            'scene3': {
                type: 'video',
                title: '第三章：风格的抉择',
                videoNote: 'video/3.mp4',
                next: 'choice3'
            },
            'choice3': {
                type: 'choice',
                title: '第三章：风格的抉择',
                choices: [
                    {
                        text: '工笔重彩',
                        nextScene: 'scene3.1'
                    },
                    {
                        text: '水墨写意',
                        nextScene: 'scene3.2'
                    },
                    {
                        text: '古典版画',
                        nextScene: 'scene3.3'
                    },
                    {
                        text: '新国风',
                        nextScene: 'scene3.4'
                    }
                ]
            },
            'scene3.1': {
                type: 'video',
                title: '工笔重彩',
                videoNote: 'video/3.1.mp4',
                next: 'choice3.1'
            },
            'scene3.2': {
                type: 'video',
                title: '水墨写意',
                videoNote: 'video/3.2.mp4',
                next: 'scene4'
            },
            'scene3.3': {
                type: 'video',
                title: '古典版画',
                videoNote: 'video/3.3.mp4',
                next: 'ending6'
            },
            'scene3.4': {
                type: 'video',
                title: '新国风',
                videoNote: 'video/3.4.mp4',
                next: 'ending7'
            },
            'choice3.1': {
                type: 'choice',
                title: '工笔重彩',
                choices: [
                    {
                        text: '降低质量',
                        nextScene: 'scene3.1.D'
                    },
                    {
                        text: '动态加载技术',
                        nextScene: 'scene3.1.E'
                    },
                    {
                        text: '购买云计算服务',
                        nextScene: 'scene3.1.F'
                    }
                ]
            },
            'scene3.1.D': {
                type: 'video',
                title: '降低质量',
                videoNote: 'video/3.1.D.mp4',
                next: 'ending8'
            },
            'scene3.1.E': {
                type: 'video',
                title: '动态加载技术',
                videoNote: 'video/3.1.E.mp4',
                next: 'scene4'
            },
            'scene3.1.F': {
                type: 'video',
                title: '购买云计算服务',
                videoNote: 'video/3.1.F.mp4',
                next: 'ending9'
            },

            //第四章
            'scene4': {
                type: 'video',
                title: '第四章：技术攻坚',
                videoNote: 'video/4.mp4',
                next: 'choice4'
            },
            'choice4': {
                type: 'choice',
                title: '第四章：技术攻坚',
                choices: [
                    {
                        text: '笔墨算法',
                        nextScene: 'scene4.1'
                    },
                    {
                        text: '意境生成',
                        nextScene: 'scene4.2'
                    },
                    {
                        text: '性能优化',
                        nextScene: 'scene4.3'
                    },
                    {
                        text: '交互逻辑',
                        nextScene: 'scene4.4'
                    }
                ]
            },
            'scene4.1': {
                type: 'video',
                title: '笔墨算法',
                videoNote: 'video/4.1.mp4',
                next: 'choice4.1'
            },
            'scene4.2': {
                type: 'video',
                title: '意境生成',
                videoNote: 'video/4.2.mp4',
                next: 'ending10'
            },
            'scene4.3': {
                type: 'video',
                title: '性能优化',
                videoNote: 'video/4.3.mp4',
                next: 'ending11'
            },
            'scene4.4': {
                type: 'video',
                title: '交互逻辑',
                videoNote: 'video/4.4.mp4',
                next: 'ending12'
            },
            'choice4.1': {
                type: 'choice',
                title: '笔墨算法',
                choices: [
                    {
                        text: '采集数据',
                        nextScene: 'scene4.1.G'
                    },
                    {
                        text: '预制笔触',
                        nextScene: 'scene4.1.H'
                    },
                    {
                        text: 'AI训练',
                        nextScene: 'scene4.1.I'
                    }
                ]
            },
            'scene4.1.G': {
                type: 'video',
                title: '采集数据',
                videoNote: 'video/4.1.G.mp4',
                next: 'ending13'
            },
            'scene4.1.H': {
                type: 'video',
                title: '预制笔触',
                videoNote: 'video/4.1.H.mp4',
                next: 'ending14'
            },
            'scene4.1.I': {
                type: 'video',
                title: 'AI训练',
                videoNote: 'video/4.1.I.mp4',
                next: 'choice4.1.I'
            },
            'choice4.1.I': {
                type: 'choice',
                title: 'AI训练',
                choices: [
                    {
                        text: '自己训练',
                        nextScene: 'scene4.1.I.I1'
                    },
                    {
                        text: '微调模型',
                        nextScene: 'scene4.1.I.I2'
                    },
                    {
                        text: '寻求外援',
                        nextScene: 'scene4.1.I.I3'
                    }
                ]
            },
            'scene4.1.I.I1': {
                type: 'video',
                title: '自己训练',
                videoNote: 'video/4.1.I.I1.mp4',
                next: 'ending15'
            },
            'scene4.1.I.I2': {
                type: 'video',
                title: '微调模型',
                videoNote: 'video/4.1.I.I2.mp4',
                next: 'ending16'
            },
            'scene4.1.I.I3': {
                type: 'video',
                title: '寻求外援',
                videoNote: 'video/4.1.I.I3.mp4',
                next: 'scene5'
            },

            //第五章
            'scene5': {
                type: 'video',
                title: '第五章：合作的诱惑',
                videoNote: 'video/5.mp4',
                next: 'choice5'
            },
            'choice5': {
                type: 'choice',
                title: '第五章：合作的诱惑',
                choices: [
                    {
                        text: '完全接受',
                        nextScene: 'scene5.1'
                    },
                    {
                        text: '有限合作',
                        nextScene: 'scene5.2'
                    },
                    {
                        text: '断然拒绝',
                        nextScene: 'scene5.3'
                    },
                    {
                        text: '反向游说',
                        nextScene: 'scene5.4'
                    }
                ]
            },
            'scene5.1': {
                type: 'video',
                title: '完全接受',
                videoNote: 'video/5.1.mp4',
                next: 'ending17'
            },
            'scene5.2': {
                type: 'video',
                title: '有限合作',
                videoNote: 'video/5.2.mp4',
                next: 'ending18'
            },
            'scene5.3': {
                type: 'video',
                title: '断然拒绝',
                videoNote: 'video/5.3.mp4',
                next: 'choice5.3'
            },
            'scene5.4': {
                type: 'video',
                title: '反向游说',
                videoNote: 'video/5.4.mp4',
                next: 'choice5.4'
            },
            'choice5.3': {
                type: 'choice',
                title: '断然拒绝',
                choices: [
                    {
                        text: '简化效果',
                        nextScene: 'scene5.3.J'
                    },
                    {
                        text: '激进理论',
                        nextScene: 'scene5.3.K'
                    }
                ]
            },
            'scene5.3.J': {
                type: 'video',
                title: '简化效果',
                videoNote: 'video/5.3.J.mp4',
                next: 'ending19'
            },
            'scene5.3.K': {
                type: 'video',
                title: '激进理论',
                videoNote: 'video/5.3.K.mp4',
                next: 'ending20'
            },
            'choice5.4': {
                type: 'choice',
                title: '反向游说',
                choices: [
                    {
                        text: '技术蓝图',
                        nextScene: 'scene5.4.L'
                    },
                    {
                        text: '艺术魅力',
                        nextScene: 'scene5.4.M'
                    },
                    {
                        text: '商业价值',
                        nextScene: 'scene5.4.N'
                    }
                ]
            },
            'scene5.4.L': {
                type: 'video',
                title: '技术蓝图',
                videoNote: 'video/5.4.L.mp4',
                next: 'ending21.1'
            },
            'scene5.4.M': {
                type: 'video',
                title: '艺术魅力',
                videoNote: 'video/5.4.M.mp4',
                next: 'scene6'
            },
            'scene5.4.N': {
                type: 'video',
                title: '商业价值',
                videoNote: 'video/5.4.N.mp4',
                next: 'ending21.2'
            },

            //第六章
            'scene6': {
                type: 'video',
                title: '第六章：内容的拷问',
                videoNote: 'video/6.mp4',
                next: 'choice6'
            },
            'choice6': {
                type: 'choice',
                title: '第六章：内容的拷问',
                choices: [
                    {
                        text: '专家顾问',
                        nextScene: 'scene6.1'
                    },
                    {
                        text: '用户共创',
                        nextScene: 'scene6.2'
                    },
                    {
                        text: 'AI生成',
                        nextScene: 'scene6.3'
                    },
                    {
                        text: '聚焦经典',
                        nextScene: 'scene6.4'
                    }
                ]
            },
            'scene6.1': {
                type: 'video',
                title: '专家顾问',
                videoNote: 'video/6.1.mp4',
                next: 'choice6.1'
            },
            'scene6.2': {
                type: 'video',
                title: '用户共创',
                videoNote: 'video/6.2.mp4',
                next: 'ending22'
            },
            'scene6.3': {
                type: 'video',
                title: 'AI生成',
                videoNote: 'video/6.3.mp4',
                next: 'ending23'
            },
            'scene6.4': {
                type: 'video',
                title: '聚焦经典',
                videoNote: 'video/6.4.mp4',
                next: 'choice6.4'
            },
            'choice6.1': {
                type: 'choice',
                title: '专家顾问',
                choices: [
                    {
                        text: '完全遵循',
                        nextScene: 'scene6.1.S'
                    },
                    {
                        text: '共同策划',
                        nextScene: 'scene6.1.T'
                    }
                ]
            },
            'scene6.1.S': {
                type: 'video',
                title: '完全遵循',
                videoNote: 'video/6.1.S.mp4',
                next: 'ending24'
            },
            'scene6.1.T': {
                type: 'video',
                title: '共同策划',
                videoNote: 'video/6.1.T.mp4',
                next: 'scene7'
            },
            'choice6.4': {
                type: 'choice',
                title: '聚焦经典',
                choices: [
                    {
                        text: '少即是多',
                        nextScene: 'scene6.4.U'
                    },
                    {
                        text: '快速迭代',
                        nextScene: 'scene6.4.V'
                    }
                ]
            },
            'scene6.4.U': {
                type: 'video',
                title: '少即是多',
                videoNote: 'video/6.4.U.mp4',
                next: 'ending25'
            },
            'scene6.4.V': {
                type: 'video',
                title: '快速迭代',
                videoNote: 'video/6.4.V.mp4',
                next: 'ending26'
            },

            //第七章
            'scene7': {
                type: 'video',
                title: '第七章：终局评审',
                videoNote: 'video/7.mp4',
                next: 'ending27',
                isEnding:true
            }
        };
        
        // 结局数据
        const endings = {
            'ending1': {
                title: '食之无味的鸡肋',
                description: '为了便捷而过度牺牲核心体验，造出无人问津的作品。',
                //quote: '"便捷的代价往往是平庸，而平庸是创作者最大的敌人。"'
            },
            'ending2': {
                title: '好高骛远的幻想',
                description: '目标脱离现实基础，导致项目在第一步就彻底夭折。',
                //quote: '"理想如星辰，我们可像航海者一样，借星光的位置而航行，却不能躺在星光上。"'
            },
            'ending3': {
                title: '沉默的大多数',
                description: '因畏惧困难而选择平庸，最终被市场洪流无声淹没。',
                //quote: '"最大的风险不是失败，而是在茫茫人海中默默无闻。"'
            },
            'ending4': {
                title: '风格的仿冒者',
                description: '满足于表面的风格模仿，失去了创造独特文化表达的勇气。',
                //quote: '"风格是思想的衣裳，没有思想的风格只是一件借来的戏服。"'
            },
            'ending5': {
                title: '优柔寡断的代价',
                description: '在关键时刻反复摇摆，浪费了宝贵的时间与机遇。',
                //quote: '"犹豫不决是以无知为基础的，最好的决策往往需要在信息不完全的情况下做出。"'
            },
            'ending6': {
                title: '孤独的艺术家',
                description: '沉醉于孤芳自赏的独特风格，却脱离了大众的审美。',
                //quote: '"艺术若只为少数人理解，就失去了它最珍贵的社会意义。"'
            },
            'ending7': {
                title: '流行的泡沫',
                description: '盲目追逐当下潮流，使作品失去了传统文化的厚重感。',
                //quote: '"潮流如同海浪，短暂而汹涌；传统如同深海，平静而永恒。"'
            },
            'ending8': {
                title: '粗糙的工笔',
                description: '向性能过度妥协，使精细的艺术风格失去了灵魂。',
                //quote: '"完美的平衡是艺术，过度的妥协是背叛。"'
            },
            'ending9': {
                title: '燃烧的预算',
                description: '试图用金钱解决技术问题，最终导致项目财政崩溃。',
                //quote: '"能用钱解决的问题都不是真正的问题，但真正的问题往往没钱也解决不了。"'
            },
            'ending10': {
                title: '不可能的任务',
                description: '挑战了远超自身能力和资源的技术天花板。',
                //quote: '"创新是站在巨人肩膀上的攀登，而不是试图一步跨过高山。"'
            },
            'ending11': {
                title: '优化的奴隶',
                description: '迷失在局部性能的调优中，忘记了产品的整体目标。',
                //quote: '"技术是手段而非目的，忘记目的的手段毫无意义。"'
            },
            'ending12': {
                title: '无用的创新',
                description: '设计的交互过于复杂反智，为用户创造了不必要的障碍。',
                //quote: '"最好的设计是看不见的设计，当你注意到它时，它往往已经失败了。"'
            },
            'ending13': {
                title: '疲惫的模仿者',
                description: '试图用笨拙的方式完全复刻现实，最终陷入低效的泥潭。',
                //quote: '"模仿现实是工匠的追求，超越现实是艺术家的使命。"'
            },
            'ending14': {
                title: '僵化的笔迹',
                description: '采用取巧但僵化的技术，让本应灵动的艺术变得呆板。',
                //quote: '"艺术的生命在于变化，僵化的表达如同枯萎的花朵。"'
            },
            'ending15': {
                title: '无限期的项目',
                description: '低估了基础工作的量级，使项目陷入无尽的数据收集。',
                //quote: '"完美是优秀的敌人，过度准备往往是拖延的借口。"'
            },
            'ending16': {
                title: '平庸的AI',
                description: '使用了未经充分调校的通用模型，产出毫无特色的结果。',
                //quote: '"工具的先进性不等于结果的优越性，真正的价值在于使用者的创造力。"'
            },
            'ending17': {
                title: '迷失的方舟',
                description: '在合作中完全放弃了自身的文化定位，使产品不伦不类。',
                //quote: '"没有原则的妥协不是灵活，而是随波逐流的迷失。"'
            },
            'ending18': {
                title: '华丽的空壳',
                description: '获得了有限的技术帮助，但核心的文化表达依然空洞。',
                //quote: '"技术是容器，内容是灵魂，没有灵魂的容器只是一个空壳。"'
            },
            'ending19': {
                title: '平庸的复制品',
                description: '在压力下退回到安全区，做出了一个毫无新意的产品。',
                //quote: '"在创新的道路上，退一步不是海阔天空，而是前功尽弃。"'
            },
            'ending20': {
                title: '理论的殉道者',
                description: '将项目成败押注于一个未经证实的激进理论上，风险极高。',
                //quote: '"理论的突破需要勇气，工程的实现需要稳健，混淆两者往往代价高昂。"'
            },
            'ending21.1': {
                title: '缺乏共鸣的合作',
                description: '试图用纯技术或商业话术说服对方，未能建立真正的理念认同。',
                //quote: '"理念的共鸣是合作的基石，缺乏共鸣的合作如同沙滩上的建筑。"'
            },
            'ending21.2': {
                title: '缺乏共鸣的合作',
                description: '试图用纯技术或商业话术说服对方，未能建立真正的理念认同。',
                //quote: '"理念的共鸣是合作的基石，缺乏共鸣的合作如同沙滩上的建筑。"'
            },
            'ending22': {
                title: '失控的广场',
                description: '开放内容创作却缺乏引导，导致内容质量失控、社区乌烟瘴气。',
                //quote: '"自由需要边界，创新需要引导，无序的创造往往导致混乱。"'
            },
            'ending23': {
                title: '正确的废话',
                description: '依赖AI生成内容，导致解读千篇一律，充满陈词滥调。',
                //quote: '"真正的理解来自于人的思考，机器只能模仿，无法创造真正的洞见。"'
            },
            'ending24': {
                title: '学院的化石',
                description: '内容过于学术和刻板，难以引发当代用户的共鸣。',
                //quote: '"传统不是博物馆里的标本，而是需要不断呼吸的生命体。"'
            },
            'ending25': {
                title: '象牙塔中的独奏',
                description: '固执于"小而美"的理念，忽视了产品的实用性与可持续性。',
                //quote: '"艺术需要纯粹，产品需要平衡，无视现实的理想主义难以长久。"'
            },
            'ending26': {
                title: '高开低走',
                description: '开局惊艳但后续乏力，因无法持续产出高质量内容而被用户抛弃。',
                //quote: '"好的开始只是成功的一半，持续的优秀才是真正的成功。"'
            },
            'ending27': {
                title: '文明的渡船',
                description: '用当代技术语言优雅地转译了传统文化内核，实现了创造性转化与创新性发展。',
                //quote: '"真正的创新不是对传统的否定，而是为古老智慧寻找当代的表达方式，让文明得以跨越时间的河流。"'
            }
        };

        // 节点位置配置（仅包含video和ending类型）
        const nodePositions = {
            // 第一列
            'start': { x: 100, y: 500, type: 'video' },
    
            // 第二列
            'scene2': { x: 400, y: 500, type: 'video' },

            //第三列
            'scene2.1': { x: 700, y: 350, type: 'video' },
            'scene2.2': { x: 700, y: 525, type: 'video' },
            'scene2.3': { x: 700, y: 625, type: 'video' },
            'scene2.4': { x: 700, y: 675, type: 'video' },

            //第四列
            'scene3': { x: 900, y: 350, type: 'video' },
            'scene2.2.A': { x: 900, y: 475, type: 'video' },
            'scene2.2.B': { x: 900, y: 525, type: 'video' },
            'scene2.2.C': { x: 900, y: 575, type: 'video' },
            'ending1': { x: 900, y: 625, type: 'ending' },
            'ending2': { x: 900, y: 675, type: 'ending' },
            
            // 第五列
            'scene3.1': { x: 1200, y: 225, type: 'video' },
            'scene3.2': { x: 1200, y: 325, type: 'video' },
            'scene3.3': { x: 1200, y: 375, type: 'video' },
            'scene3.4': { x: 1200, y: 425, type: 'video' },
            'ending3': { x: 1200, y: 475, type: 'ending' },
            'ending4': { x: 1200, y: 525, type: 'ending' },
            'ending5': { x: 1200, y: 575, type: 'ending' },
            

            //第六列
            'scene3.1.D': { x: 1500, y: 175, type: 'video' },
            'scene3.1.E': { x: 1500, y: 225, type: 'video' },
            'scene3.1.F': { x: 1500, y: 275, type: 'video' },
            'ending6': { x: 1500, y: 375, type: 'ending' },
            'ending7': { x: 1500, y: 425, type: 'ending' },
            
            //第七列
            'ending8': { x: 1800, y: 175, type: 'ending' },
            'ending9': { x: 1800, y: 275, type: 'ending' },
    
            // 第八列
            'scene4': { x: 2100, y: 275, type: 'video' },

            //第九列
            'scene4.1': { x: 2400, y: 250, type: 'video' },
            'scene4.2': { x: 2400, y: 925, type: 'video' },
            'scene4.3': { x: 2400, y: 975, type: 'video' },
            'scene4.4': { x: 2400, y: 1025, type: 'video' },

            //第十列
            'scene4.1.G': { x: 2600, y: 125, type: 'video' },
            'scene4.1.H': { x: 2600, y: 175, type: 'video' },
            'scene4.1.I': { x:2600, y: 375, type: 'video' },
            'ending10': { x: 2600, y: 925, type: 'ending' },
            'ending11': { x: 2600, y: 975, type: 'ending' },
            'ending12': { x: 2600, y: 1025, type: 'ending' },
            
            //第十一列
            'ending13': { x: 2900, y: 125, type: 'ending' },
            'ending14': { x: 2900, y: 175, type: 'ending' },
            'scene4.1.I.I1': { x: 2900, y: 225, type: 'video' },
            'scene4.1.I.I2': { x: 2900, y: 275, type: 'video' },
            'scene4.1.I.I3': { x: 2900, y: 500, type: 'video' },
    
            // 第十二列
            'ending15': { x: 3200, y: 225, type: 'ending' },
            'ending16': { x: 3200, y: 275, type: 'ending' },
            'scene5': { x: 3200, y: 500, type: 'video' },

            //第十三列
            'scene5.1': { x: 3500, y: 325, type: 'video' },
            'scene5.2': { x: 3500, y: 375, type: 'video' },
            'scene5.3': { x: 3500, y: 450, type: 'video' },
            'scene5.4': { x: 3500, y: 700, type: 'video' },

            //第十四列
            'ending17': { x: 3700, y: 325, type: 'ending' },
            'ending18': { x: 3700, y: 375, type: 'ending' },
            'scene5.3.J': { x: 3700, y: 425, type: 'video' },
            'scene5.3.K': { x: 3700, y: 475, type: 'video' },
            'scene5.4.L': { x: 3700, y: 525, type: 'video' },
            'scene5.4.M': { x: 3700, y: 700, type: 'video' },
            'scene5.4.N': { x: 3700, y: 875, type: 'video' },

            //第十五列
            'ending19': { x: 4000, y: 425, type: 'ending' },
            'ending20': { x: 4000, y: 475, type: 'ending' },
            'ending21.1': { x: 4000, y: 525, type: 'ending' },
            'scene6': { x: 4000, y: 700, type: 'video' },
            'ending21.2': { x: 4000, y: 875, type: 'ending' },
    
            //第十六列
            'scene6.1': { x: 4300, y: 600, type: 'video' },
            'scene6.2': { x: 4300, y: 675, type: 'video' },
            'scene6.3': { x: 4300, y: 725, type: 'video' },
            'scene6.4': { x: 4300, y: 800, type: 'video' },

            //第十七列
            'scene6.1.S': { x: 4500, y: 575, type: 'video' },
            'scene6.1.T': { x: 4500, y: 625, type: 'video' },
            'ending22': { x: 4500, y: 675, type: 'ending' },
            'ending23': { x: 4500, y: 725, type: 'ending' },
            'scene6.4.U': { x: 4500, y: 775, type: 'video' },
            'scene6.4.V': { x: 4500, y: 825, type: 'video' },

            //第十八列
            'ending24': { x: 4800, y: 575, type: 'ending' },
            'scene7': { x: 4800, y: 625, type: 'video' },
            'ending25': { x: 4800, y: 775, type: 'ending' },
            'ending26': { x: 4800, y: 825, type: 'ending' },

            //第十九列
            'ending27': { x: 5100, y: 625, type: 'ending' }
        };

        // 连接关系配置（包含choice信息）
        const connections = [
            // 第一列到第二列
            { from: 'start', to: 'scene2',choice: '', label: '' },
    
            // 第二列到第三列
            { from: 'scene2', to: 'scene2.1', choice: 'choice2', label: ''},
            { from: 'scene2', to: 'scene2.2', choice: 'choice2' , label: ''},
            { from: 'scene2', to: 'scene2.3', choice: 'choice2', label: ''},
            { from: 'scene2', to: 'scene2.4', choice: 'choice2' , label: ''},
            
            //第三列到第四列
            { from: 'scene2.1', to: 'scene3', choice: '', label: '' },
            { from: 'scene2.2', to: 'scene2.2.A', choice: 'choice2.2', label: '接受现实' },
            { from: 'scene2.2', to: 'scene2.2.B', choice: 'choice2.2', label: '开发滤镜' },
            { from: 'scene2.2', to: 'scene2.2.C', choice: 'choice2.2', label: '推翻重来' },
            { from: 'scene2.3', to: 'ending1', choice: '', label: ''},
            { from: 'scene2.4', to: 'ending2', choice: '' , label: ''},
            
            //第四列到第五列
            { from: 'scene3', to: 'scene3.1', choice: 'choice3', label: '工笔重彩' },
            { from: 'scene3', to: 'scene3.2', choice: 'choice3', label: '水墨写意' },
            { from: 'scene3', to: 'scene3.3', choice: 'choice3', label: '工笔重彩' },
            { from: 'scene3', to: 'scene3.4', choice: 'choice3', label: '水墨写意' },
            { from: 'scene2.2.A', to: 'ending3', choice: '', label: '接受现实' },
            { from: 'scene2.2.B', to: 'ending4', choice: '', label: '开发滤镜' },
            { from: 'scene2.2.C', to: 'ending5', choice: '', label: '推翻重来' },
            
            //第五列到第六列
            { from: 'scene3.1', to: 'scene3.1.D', choice: 'choice3.1', label: '降低质量' },
            { from: 'scene3.1', to: 'scene3.1.E', choice: 'choice3.1', label: '动态加载技术' },
            { from: 'scene3.1', to: 'scene3.1.F', choice: 'choice3.1', label: '购买云计算服务' },
            { from: 'scene3.3', to: 'ending6', choice: '', label: '古典版画' },
            { from: 'scene3.4', to: 'ending7', choice: '', label: '新国风' },
    
            //第六列到第七列
            { from: 'scene3.1.D', to: 'ending8', choice: '', label: '降低质量' },
            { from: 'scene3.1.F', to: 'ending9', choice: '', label: '购买云计算服务' },
            
            //到第八列
            { from: 'scene3.1.E', to: 'scene4', choice: '', label: '' },
            { from: 'scene3.2', to: 'scene4', choice: '', label: '' },

            // 第八列到第九列
            { from: 'scene4', to: 'scene4.1', choice: 'choice4', label: '笔墨算法' },
            { from: 'scene4', to: 'scene4.2', choice: 'choice4', label: '意境生成' },
            { from: 'scene4', to: 'scene4.3', choice: 'choice4', label: '性能优化' },
            { from: 'scene4', to: 'scene4.4', choice: 'choice4', label: '交互逻辑' },
    
            // 第九列到第十列
            { from: 'scene4.1', to: 'scene4.1.G', choice: 'choice4.1', label: '采集数据' },
            { from: 'scene4.1', to: 'scene4.1.H', choice: 'choice4.1', label: '预制笔触' },
            { from: 'scene4.1', to: 'scene4.1.I', choice: 'choice4.1', label: 'AI训练' },
            { from: 'scene4.2', to: 'ending10', choice: '', label: '意境生成' },
            { from: 'scene4.3', to: 'ending11', choice: '', label: '性能优化' },
            { from: 'scene4.4', to: 'ending12', choice: '', label: '交互逻辑' },
            
            //第十一列到第十二列
            { from: 'scene4.1.G', to: 'ending13', choice: '', label: '采集数据' },
            { from: 'scene4.1.H', to: 'ending14', choice: '', label: '预制笔触' },
            { from: 'scene4.1.I', to: 'scene4.1.I.I1', choice: 'choice4.1.I', label: '自己训练' },
            { from: 'scene4.1.I', to: 'scene4.1.I.I2', choice: 'choice4.1.I', label: '微调模型' },
            { from: 'scene4.1.I', to: 'scene4.1.I.I3', choice: 'choice4.1.I', label: '寻求外援' },
    
            // 第十二列到第十三列
            { from: 'scene4.1.I.I1', to: 'ending15', choice: '', label: '自己训练' },
            { from: 'scene4.1.I.I2', to: 'ending16', choice: '', label: '微调模型' },
            { from: 'scene4.1.I.I3', to: 'scene5', choice: '', label: '' },

            //第十三列到第十四列
            { from: 'scene5', to: 'scene5.1', choice: 'choice5', label: '完全接受' },
            { from: 'scene5', to: 'scene5.2', choice: 'choice5', label: '有限合作' },
            { from: 'scene5', to: 'scene5.3', choice: 'choice5', label: '断然拒绝' },
            { from: 'scene5', to: 'scene5.4', choice: 'choice5', label: '反向游说' },
    
            //第十四列到第十五列
            { from: 'scene5.1', to: 'ending17', choice: '', label: '完全接受' },
            { from: 'scene5.2', to: 'ending18', choice: '', label: '有限合作' },
            { from: 'scene5.3', to: 'scene5.3.J', choice: 'choice5.3', label: '简化效果' },
            { from: 'scene5.3', to: 'scene5.3.K', choice: 'choice5.3', label: '激进理论' },
            { from: 'scene5.4', to: 'scene5.4.L', choice: 'choice5.4', label: '技术蓝图值' },
            { from: 'scene5.4', to: 'scene5.4.M', choice: 'choice5.4', label: '艺术魅力' },
            { from: 'scene5.4', to: 'scene5.4.N', choice: 'choice5.4', label: '商业价值' },

            //第十五列到第十六列
            { from: 'scene5.3.J', to: 'ending19', choice: '', label: '简化效果' },
            { from: 'scene5.3.K', to: 'ending20', choice: '', label: '激进理论' },
            { from: 'scene5.4.L', to: 'ending21.1', choice: '', label: '技术蓝图' },
            { from: 'scene5.4.M', to: 'scene6', choice: '', label: '' },
            { from: 'scene5.4.N', to: 'ending21.2', choice: '', label: '商业价值' },
    
            // 第十六列到第十七列
            { from: 'scene6', to: 'scene6.1', choice: 'choice6', label: '专家顾问' },
            { from: 'scene6', to: 'scene6.2', choice: 'choice6', label: '用户共创' },
            { from: 'scene6', to: 'scene6.3', choice: 'choice6', label: 'AI生成' },
            { from: 'scene6', to: 'scene6.4', choice: 'choice6', label: '聚焦经典' },
    
            //第十七列到第十八列
            { from: 'scene6.1', to: 'scene6.1.S', choice: 'choice6.1', label: '完全遵循' },
            { from: 'scene6.1', to: 'scene6.1.T', choice: 'choice6.1', label: '共同策划' },
            { from: 'scene6.2', to: 'ending22', choice: '', label: '用户共创' },
            { from: 'scene6.3', to: 'ending23', choice: '', label: 'AI生成' },
            { from: 'scene6.4', to: 'scene6.4.U', choice: 'choice6.4', label: '少即是多' },
            { from: 'scene6.4', to: 'scene6.4.V', choice: 'choice6.4', label: '快速迭代' },
            
            //第十八列到第十九列
            { from: 'scene6.1.S', to: 'ending24', choice: '', label: '完全遵循' },
            { from: 'scene6.1.T', to: 'scene7', choice: '', label: '' },
            { from: 'scene6.4.U', to: 'ending25', choice: '', label: '少即是多' },
            { from: 'scene6.4.V', to: 'ending26', choice: '', label: '快速迭代' },
            
            // 第十九列到第二十列
            { from: 'scene7', to: 'ending27', choice: '', label: '' }
        ];
        
        // 初始化游戏
        function initGame() {
            // 绑定事件监听器
            startBtn.addEventListener('click', startGame);  // 绑定开始游戏按钮的点击事件
            restartBtn.addEventListener('click', restartGame);  // 绑定重新开始按钮的点击事件

            // 初始化游戏状态
            resetGameState();
        }
        
        // 重置游戏状态
        function resetGameState() {
            // 重置当前场景为起始场景
            currentScene = 'start';

            // // 清空游戏状态（包括选择记录等）
            // gameState = {
            //     choices: []
            // };

            // 清空游戏历史记录
            gameHistory = [];

            // 重置视频播放器状态（停止播放并隐藏）
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.pause();
                videoPlayer.src = '';
                videoPlayer.style.display = 'none';
            }

            coverScreen.style.opacity = '1';   
            coverScreen.style.display = 'flex';
            gameScreen.style.opacity = '0';
            gameScreen.style.display = 'none';
            endingScreen.style.opacity = '0'; 
            endingScreen.style.display = 'none'; 

            // 清空选项容器
            choicesContainer.innerHTML = '';
        }

        // 开始游戏
        function startGame() {
            coverScreen.style.opacity = '0';   // 封面页淡出
            coverScreen.style.display = 'none'; // 封面页隐藏
            gameScreen.style.display = 'flex'; // 显示游戏界面
            gameScreen.style.opacity = '1';    // 游戏界面淡入
            loadScene('start');                // 加载第一个场景
        }
        
        // 重新开始游戏
        function restartGame() {
            resetGameState(); // 重置游戏状态

            // 切换到游戏页面
            endingScreen.style.opacity = '0';  // 结局页淡出
            endingScreen.style.display = 'none'; // 结局页隐藏
            startGame(); // 重新开始游戏
        }
        
        // 加载场景
        function loadScene(sceneId) {
            //初始化场景信息
            currentScene = sceneId;  // 记录当前场景ID（全局变量，用于跟踪进度）
            const scene = gameScenes[sceneId];  // 从界面场景及跳转逻辑数据中获取当前场景详情
            if (!scene) return;  // 如果场景不存在，终止执行（避免报错）
            
            // 检查当前场景是否已存在于历史记录中
            const isInHistory = gameHistory.some(item => item.nodeId === sceneId); 

            //记录历史与更新场景信息
            saveHistory(sceneId); // 保存当前场景ID到历史记录（可能用于回溯或统计）
            sceneInfo.textContent = scene.title; // 更新界面顶部的场景标题（如“第一章：创意的基石”）
            
            //处理视频场景（scene.type === 'video'）
            if (scene.type === 'video') {
                // 清空容器
                choicesContainer.innerHTML = '';  // 清空选项按钮容器（避免残留上一场景的按钮）
                
                //获取视频播放器元素并验证
                const videoPlayer = document.getElementById('videoPlayer');
                if (!videoPlayer) {
                    console.error('未找到videoPlayer元素,请检查HTML中的id是否正确');
                    return; // 元素不存在时终止执行
                }

                //配置播放器属性
                //videoPlayer.controls = true; //显示播放控制栏（暂停、进度条等）
                videoPlayer.src = scene.videoNote; //设置视频源（路径从场景数据中获取，如"video/1.mp4"）
                videoPlayer.style.display = 'block'; // 显示视频播放器
                videoPlayer.style.width = '100%'; // 自适应容器宽度
                videoPlayer.style.height = 'auto'; // 自适应高度
                videoPlayer.style.margin = '0 auto'; // 居中显示
                videoPlayer.load(); // 加载视频
                videoPlayer.play(); // 自动播放（可能需要用户交互才能触发，取决于浏览器政策）
                videoPlayer.zIndex = 25; // 视频层级低于选项
                // 控制进度条显示：存在于历史记录 → 显示；不存在 → 隐藏
                if (isInHistory) {
                    videoPlayer.controls = true; // 显示播放控制栏（暂停、进度条等）
                } else {
                    videoPlayer.controls = false; // 隐藏播放控制栏（暂停、进度条等）
                }

                // 视频播放结束后自动进入下一场景
                videoPlayer.onended = () => {
                    //videoPlayer.style.display = 'none'; // 隐藏播放器
                    if (scene.next) {
                        if (scene.next in endings) {
                            if (!endings[scene.next]) {
                                console.error('结局数据不存在:', choice.nextScene);
                                return;
                            }
                            showEnding(scene.next); // 如果是结局，显示对应的结局页面
                        } 
                        else {
                            loadScene(scene.next);  // 如果不是结局，加载下一个场景
                        }
                    }
                };
                
                // 视频加载失败处理
                videoPlayer.onerror = () => {
                    console.error('视频加载失败，请检查路径或格式');
                    // 可选：显示错误提示，允许用户手动跳过
                    alert('视频加载失败，即将进入下一环节');
                    if (scene.next) {
                        loadScene(scene.next);
                    }
                };          
            } 
            //处理选择场景（scene.type === 'choice'）
            else if (scene.type === 'choice') {
                choicesContainer.innerHTML = ''; // 清空旧选项
                // 创建选择按钮
                scene.choices.forEach((choice, index) => {                        // 遍历场景中的选项数组
                    const button = document.createElement('button');              // 创建按钮元素
                    button.className = 'choice-btn';                      // 应用按钮样式和淡入动画
                    button.type = 'button'; // 新增这一行，明确指定为普通按钮
                    button.textContent = choice.text;                             // 按钮文字（如“选项A”）
                    //button.style.animationDelay = `${index * 0.1}s`;            // 按钮按顺序延迟出现（增强层次感）
                    button.addEventListener('click', () => {makeChoice(index);}); // 绑定点击事件（选择后执行makeChoice）
                    choicesContainer.appendChild(button);                         // 将按钮添加到选项容器中
                });
            }
        }

        // 做出选择
        function makeChoice(choiceIndex) {
            //获取当前场景和选择的选项
            const scene = gameScenes[currentScene];    // 获取当前场景的详情（从场景数据中）
            const choice = scene.choices[choiceIndex]; // 获取玩家选择的具体选项（根据索引）
            
            if (!choice) {
                console.error('无效的选项索引:', choiceIndex);
                return;
            }
            
            // //记录玩家的选择到游戏状态
            // gameState.choices.push({
            //     scene: currentScene,  // 当前场景ID（如 'choice1'）
            //     choice: choiceIndex,  // 选择的选项序号（如 0）
            //     text: choice.text     // 选择的选项文字（如 '我选择A'）
            // });

            // 检查是否是结局
            if (choice.nextScene in endings) {
                if (!endings[choice.nextScene]) {
                    console.error('结局数据不存在:', choice.nextScene);
                    return;
                }
                showEnding(choice.nextScene); // 如果是结局，显示对应的结局页面
            } else {
                loadScene(choice.nextScene);  // 如果不是结局，加载下一个场景
            }
        }
            
            
        
        // 显示结局
        function showEnding(endingId) {
            // 获取结局信息
            const ending = endings[endingId]; // 从结局数据中获取当前结局的详情
            if (!ending) return;

            // 保存结局节点到历史记录
            saveHistory(endingId);  // 新增这一行
            
            console.log('开始切换到结局页面'); // 第一步日志!!!

            // 更新结局页面
            endingTitle.textContent = ending.title;             // 更新结局标题
            endingDescription.textContent = ending.description; // 更新结局描述
            //endingQuote.textContent = ending.quote;

            // 切换到结局页面
            gameScreen.style.opacity = '0';  // 游戏主界面淡出
            gameScreen.style.display = 'none'; // 游戏主界面隐藏

            // 确保结局页面先设置为可见再执行动画
            endingScreen.style.display = 'flex';
            endingScreen.style.opacity = '1';

            console.log('结局页面显示逻辑完成'); // 第三步日志
        }

        // 添加故事线按钮到游戏界面
        function addStorylineButton() {
            // 游戏场景中的故事线按钮
            const gameBtn = document.createElement('button');
            gameBtn.id = 'storyline-btn';
            gameBtn.className = 'storyline-btn';
            gameBtn.textContent = '故事线';
            gameBtn.style.position = 'absolute';
            gameBtn.style.top = '20px';
            gameBtn.style.right = '20px';
            gameBtn.style.zIndex = '100';
            gameBtn.style.padding = '8px 15px';
            gameBtn.style.background = 'rgba(0,0,0,0.5)';
            gameBtn.style.color = '#d4af37';
            gameBtn.style.border = '1px solid #d4af37';
            gameBtn.style.borderRadius = '5px';
            gameBtn.style.cursor = 'pointer';
            gameBtn.addEventListener('click', showStoryline);
            gameScreen.appendChild(gameBtn);

            // 结局页面中的故事线按钮
            const endingBtn = document.createElement('button');
            endingBtn.id = 'ending-storyline-btn';
            endingBtn.className = 'storyline-btn';
            endingBtn.textContent = '查看故事线';
            endingBtn.style.marginTop = '20px';
            endingBtn.style.padding = '8px 15px';
            endingBtn.style.background = 'rgba(0,0,0,0.5)';
            endingBtn.style.color = '#d4af37';
            endingBtn.style.border = '1px solid #d4af37';
            endingBtn.style.borderRadius = '5px';
            endingBtn.style.cursor = 'pointer';
            endingBtn.addEventListener('click', showStoryline); 
            document.querySelector('.ending-buttons').appendChild(endingBtn);
        }

        // 显示故事线页面
        function showStoryline() {
            gameScreen.style.opacity = '0';
            gameScreen.style.display = 'none';
            endingScreen.style.opacity = '0';
            endingScreen.style.display = 'none';
            storylineScreen.style.display = 'block';
            storylineScreen.style.opacity = '1';
            renderStoryline();
        }

        // 关闭故事线页面
        function closeStoryline() {
            storylineScreen.style.opacity = '0';
            storylineScreen.style.display = 'none';
            if (currentScene in endings) {
                endingScreen.style.display = 'flex';
                endingScreen.style.opacity = '1';
            } else {
                gameScreen.style.display = 'flex';
                gameScreen.style.opacity = '1';
                }
        }

        // 渲染故事线图谱
        function renderStoryline() {
            storylineGraph.innerHTML = '';
    
            // 获取已访问的节点
            const visitedNodes = gameHistory.map(item => item.nodeId);
            const currentNode = currentScene;
    
            // 绘制连接线和选择点
            connections.forEach(conn => {
                // 绘制一端的节点已访问的连接线
                if (visitedNodes.includes(conn.from) ) {
                    drawConnector(conn.from, conn.to, conn.choice, conn.label);
            }
            });
    
            // 绘制节点（仅video和ending）
            Object.keys(nodePositions).forEach(nodeId => {
                const node = nodePositions[nodeId];
                // 只显示已访问的节点且类型为video或ending
                if (visitedNodes.includes(nodeId) && (node.type === 'video' || node.type === 'ending')) {
                    drawNode(nodeId, node.type, visitedNodes.includes(nodeId), nodeId === currentNode);
                }
            });
        }

        // 绘制节点
        function drawNode(nodeId, type, isVisited, isCurrent) {
            const node = document.createElement('div');
            node.className = `story-node ${type} ${isVisited ? 'visited' : ''} ${isCurrent ? 'current' : ''}`;
    
            // 获取节点位置
            const pos = nodePositions[nodeId];
            if (!pos) return;
    
            node.style.left = `${pos.x}px`;
            node.style.top = `${pos.y}px`;
    
            // 显示节点标题
            const scene = gameScenes[nodeId] || endings[nodeId];
            node.textContent = scene ? scene.title.substring(0, 10) + (scene.title.length > 10 ? '...' : '') : nodeId;
    
            // 添加点击事件（仅已访问节点可点击）
            if (isVisited) {
                node.addEventListener('click', () => {
                    if (confirm(`确定要回到${scene.title}吗？`)) {
                        goToScene(nodeId);
                        closeStoryline();
                }
            });
            }
    
            storylineGraph.appendChild(node);
        }

        // 绘制连接线和选择点
        function drawConnector(fromId, toId, choiceId) {
            //获取节点位置
            const from = nodePositions[fromId]; //从 nodePositions 对象中获取起点和终点节点的坐标信息（x、y 位置）
            const to = nodePositions[toId];
            if (!from || !to) return; //如果节点位置不存在，则直接退出函数
    
            // 计算节点中心位置
            const fromCenterX = from.x + 75; // 节点宽度的一半 （默认节点宽 120px、高 40px）
            const fromCenterY = from.y + 20; // 节点高度的一半
            const toCenterX = to.x + 75;
            const toCenterY = to.y + 20;
    
            // 绘制连接线
            // 水平连接线
            if (Math.abs(fromCenterY - toCenterY) < 10) {
                const connector = document.createElement('div');
                connector.className = 'story-connector connector-horizontal';
                connector.style.left = `${Math.min(fromCenterX, toCenterX)}px`;
                connector.style.top = `${fromCenterY}px`;
                connector.style.width = `${Math.abs(fromCenterX - toCenterX)}px`;
                storylineGraph.appendChild(connector);
        
            } 
            // 拐角连接线 - 先水平后垂直后水平
            else {
                //先水平
                const horizontal1 = document.createElement('div');  //使用 document.createElement('div') 创建一个新的 div 元素，作为水平连接线的载体。
                horizontal1.className = 'story-connector connector-horizontal';  //为水平线段添加两个 CSS 类：
                //story-connector：连接线的基础样式（如线条颜色、粗细等）。
                //connector-horizontal：水平方向特有的样式（如高度固定为 2px 等）。
                horizontal1.style.left = `${fromCenterX}px`;  //设置水平线段的左侧 left 坐标为起点节点的中心 X 坐标（fromCenterX），即线段从起点中心开始水平延伸。
                horizontal1.style.top = `${fromCenterY}px`;   //设置水平线段的左侧 top  坐标为起点节点的中心 Y 坐标（fromCenterY），确保线段与起点中心对齐。
                horizontal1.style.width = `${Math.abs(fromCenterX - toCenterX)-100}px`;  //线段长度为起点中心 X 坐标与终点中心 X 坐标的差值的绝对值（Math.abs 确保长度为正数），即水平方向从起点到终点的距离。
                storylineGraph.appendChild(horizontal1);
        
                const vertical = document.createElement('div');
                vertical.className = 'story-connector connector-vertical';
                vertical.style.left = `${toCenterX-100}px`;
                vertical.style.top = `${Math.min(fromCenterY, toCenterY)}px`;
                vertical.style.height = `${Math.abs(fromCenterY - toCenterY)}px`;
                storylineGraph.appendChild(vertical);

                //再水平
                const horizontal2 = document.createElement('div');  //使用 document.createElement('div') 创建一个新的 div 元素，作为水平连接线的载体。
                horizontal2.className = 'story-connector connector-horizontal';  //为水平线段添加两个 CSS 类：
                horizontal2.style.left = `${toCenterX-100}px`;  
                horizontal2.style.top = `${toCenterY}px`;   
                horizontal2.style.width = `${100}px`; 
                storylineGraph.appendChild(horizontal2);
            }
        }
        
        // 跳转到指定节点（支持场景和结局，修复视频错误）
function goToScene(nodeId) {
    // 判断节点类型：是结局还是场景
    const isEnding = Boolean(endings[nodeId]);
    const isScene = !isEnding && Boolean(gameScenes[nodeId]);

    // 仅在跳转场景时处理视频播放器（结局不需要视频）
    if (isScene) {
        const videoPlayer = document.getElementById('videoPlayer');
        if (videoPlayer) {
            videoPlayer.pause();
            videoPlayer.src = ''; // 清空场景视频源
        }
    }

    // 更新当前节点
    currentScene = nodeId;

    // 隐藏故事线界面
    storylineScreen.style.opacity = '0';
    storylineScreen.style.display = 'none';

    // 分支处理：结局显示结局界面，场景加载场景
    if (isEnding) {
        showEnding(nodeId); // 显示结局（无需视频操作）
    } else if (isScene) {
        gameScreen.style.display = 'flex';
        gameScreen.style.opacity = '1';
        loadScene(nodeId); // 加载场景（已处理视频）
    } else {
        console.warn(`未知节点类型：${nodeId}`);
    }
}
        // 初始化故事线功能
        function initStoryline() {
            addStorylineButton();
            closeStorylineBtn.addEventListener('click', closeStoryline);
        }

        // 保存历史记录（支持scene和ending）
        function saveHistory(nodeId) {
            // 查找当前节点（场景或结局）是否已在历史中
             existingIndex = gameHistory.findIndex(item => item.nodeId === nodeId);
            if (existingIndex !== -1) {
                return;
            }
    
            // 判断节点类型（是场景还是结局）
            const isScene = Boolean(gameScenes[nodeId]);
            const isEnding = !isScene && Boolean(endings[nodeId]);

            if (!isScene && !isEnding) {
                console.warn(`未知节点类型: ${nodeId}，未保存到历史`);
                return;
            }
    
            // 添加当前节点到历史（统一用nodeId，增加type字段区分类型）
            gameHistory.push({
                index: gameHistory.length,
                nodeId: nodeId,          // 统一使用nodeId代替sceneId，兼容场景和结局
                type: isScene ? 'scene' : 'ending', // 标记节点类型
                choiceIndex: null
            });
        }
        
        // 初始化游戏
        window.addEventListener('DOMContentLoaded', initGame);
        // 在游戏初始化时启动故事线功能
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(initStoryline, 100); // 等待原有初始化完成后再初始化故事线
        });

    </script>
</body>
</html>